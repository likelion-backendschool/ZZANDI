## ğŸ“Œ íŒ€ êµ¬ì„±ì›

**[íŒ€ì¥] ì •ìœ¤ì•„, ê¹€ë™ë¯¼, ì†¡ì£¼í™˜, ì¡°ì•„ì˜, ì´ì¬í˜¸**

<br>

## ğŸ“Œ íšŒê³  ë‚´ìš© ìš”ì•½

### **â” `CascadeType.REMOVE` vs. `orphanRemoval = true`**

**`CascadeType.REMOVE`**

- **ë¶€ëª¨ ì—”í‹°í‹°ê°€ ì‚­ì œë˜ë©´ ìì‹ ì—”í‹°í‹°ë„ ì‚­ì œí•œë‹¤. â†’ `ë¶€ëª¨ê°€ ìì‹ì˜ ìƒëª… ì£¼ê¸°ë¥¼ ê´€ë¦¬`í•œë‹¤.**
- **CascadeType.PERSISTë„ í•¨ê»˜ ì‚¬ìš©í•˜ë©´, ìì‹ì˜ ì „ì²´ì ì¸ ìƒëª… ì£¼ê¸°ë¥¼ ë¶€ëª¨ê°€ ê´€ë¦¬í•œë‹¤.**
- **ë¶€ëª¨ ì—”í‹°í‹°ì™€ ì—°ê²°ë˜ì–´ ìˆëŠ” ìì‹ ì—”í‹°í‹°ë¥¼ ì‚­ì œí•˜ëŠ” ê²½ìš°, ì‚­ì œë˜ì§€ ì•Šê³  ê·¸ëŒ€ë¡œ ë‚¨ì•„ìˆë‹¤.**

<br>

**`orphanRemoval = true`**

- **Cascade ì˜µì…˜ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ ë¶€ëª¨ê°€ ì—”í‹°í‹°ê°€ ì‚­ì œë˜ë©´ ìì‹ ì—”í‹°í‹°ë¥¼ ì‚­ì œí•˜ëŠ” ì˜µì…˜ì´ë‹¤.**
- **CascadeType.PERSISTë¥¼ í•¨ê»˜ ì‚¬ìš©í•˜ë©´ ìì‹ ì—”í‹°í‹°ì˜ ì „ì²´ì ì¸ ìƒëª… ì£¼ê¸°ë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤.**
- **CascadeType.REMOVE ì˜µì…˜ê³¼ ë‹¤ë¥¸ ì ì€ ë¶€ëª¨ ì—”í‹°í‹°ì™€ ì—°ê²°ë˜ì–´ ìˆëŠ”
  ìì‹ ì—”í‹°í‹°ë¥¼ ì‚­ì œí•˜ë©´ `ê³ ì•„ë¡œ ì·¨ê¸‰`ë˜ì–´ ì‚­ì œê°€ ëœë‹¤ëŠ” ì ì´ë‹¤.**

<br>

**â— ë¹„êµì™€ ì£¼ì˜ì‚¬í•­**

- **ë¶€ëª¨ ì—”í‹°í‹° ì‚­ì œ**
  - **ë‘ ì˜µì…˜ ëª¨ë‘ ë¶€ëª¨ ì—”í‹°í‹°ì™€ ë¶€ëª¨ì™€ ì—°ê²°ëœ ìì‹ ì—”í‹°í‹°ë¥¼ í•¨ê»˜ ì‚­ì œí•œë‹¤.**
- **ë¶€ëª¨ ì—”í‹°í‹°ì—ì„œ ìì‹ ì—”í‹°í‹° ì‚­ì œ**
  - **CascadeType.REMOVE : ìì‹ ì—”í‹°í‹°ë¥¼ ì‚­ì œí•˜ì§€ ì•ŠëŠ”ë‹¤.**
  - **orphanRemoval = true : ìì‹ ì—”í‹°í‹°ë¥¼ ê³ ì•„ë¡œ ì·¨ê¸‰í•˜ì—¬ ì‚­ì œí•œë‹¤.**

<br>

**`ë‘ ì˜µì…˜ ëª¨ë‘ ìì‹ ì—”í‹°í‹°ì— ì—°ê´€ ê´€ê³„ê°€ ë”± í•˜ë‚˜ë§Œ ê±¸ë ¤ìˆëŠ” ê²½ìš°ì—ë§Œ ì‚¬ìš©í•´ì•¼ í•œë‹¤.`**

**ë§Œì•½ ìì‹ì´ ë‘ ê°œì˜ ë¶€ëª¨ ì—”í‹°í‹°ë¥¼ ê°€ì§€ëŠ” ê²½ìš°ì— í•œ ê³³ì—ì„œ ìì‹ ì—”í‹°í‹°ë¥¼ ì‚­ì œí•œë‹¤ë©´,
ë‹¤ë¥¸ ë¶€ëª¨ ì—”í‹°í‹°ì—ì„œë„ ì‚­ì œê°€ ë˜ëŠ” ëŒ€ì°¸ì‚¬ê°€ ë°œìƒí•˜ê¸° ë•Œë¬¸ì´ë‹¤.**

<br>

### â” QueryDSL

1. **ê´€ì‹¬ì‚¬ ì¤‘ë³µ ì—†ì´ ê°€ì ¸ì˜¤ê¸° + USER ì¡°ì¸ + FOLLOWER ì¡°ì¸ + WHEREì ˆ ì¶”ê°€**

```sql
jpaQueryFactory
    .select(interestKeyword.content)
    .distinct()
    .from(interestKeyword)
    .innerJoin(interestKeyword.user, siteUser) // site_user
    .innerJoin(siteUser.followers, siteUser2)
    .where(siteUser2.id.eq(user.getId()))
    .fetch();
```

```sql
SELECT DISTINCT IK.content
FROM interest_keyword AS IK

INNER JOIN site_user AS SU1
ON IK.user_id = SU1.id

INNER JOIN site_user_followers AS SUFR
ON SU1.id = SUFR.site_user_id

INNER JOIN site_user AS SU2
ON SUFR.followers_id = SU2.id

WHERE SU2.id = 8;
```

2. **ë‘ ë²ˆì˜ ì¿¼ë¦¬ë¡œ ë‚˜ëˆ„ì–´ ì¡°íšŒí•´ì˜¤ê¸°**

```sql
jpaQueryFactory.select(interestKeyword.content).distinct()
    .from(interestKeyword)
    .where(interestKeyword.user.in(user.getFollowings()))
    .fetch();
```

```sql
SELECT *
FROM site_user_followings AS SUFW
INNER JOIN site_user AS SU1
ON SUFW.followings_id = SU1.id
WHERE SUFW.site_user_id = 8;

SELECT DISTINCT IK.content
FROM interest_keyword AS IK
WHERE IK.user_id in (7 , 4 , 5 , 6 , 3);
```

**3. ì¡°ê¸ˆ ë” ìµœì í™”**

```sql
QSiteUser siteUser2 = new QSiteUser("SU2");

List<Long> ids = jpaQueryFactory.select(siteUser.id)
    .from(siteUser)
    .innerJoin(siteUser.followers, siteUser2)
    .where(siteUser2.id.eq(user.getId()))
    .fetch();

jpaQueryFactory.select(interestKeyword.content).distinct()
    .from(interestKeyword)
    .where(interestKeyword.user.id.in(ids))
    .fetch();
```

<br>

### ğŸ“Œ **Spring boot File upload**

**â”application.yml**

```yaml
spring:
  profiles:
    active: dev, base-addi

...

custom:
  genFileDirPath: c:/temp/spring-file
```

- **profiles.active : application-dev.ymlê³¼ application-base-addi.ymlì„ ë”°ë¡œ ìƒì„±í•˜ì—¬ í™œìš©í•  ìˆ˜ ìˆë‹¤.**
- **custom.genFileDirPath : íŒŒì¼ì´ ìƒì„±ë  í´ë”ë¥¼ ì§€ì •í•´ë‘”ë‹¤.**

<br>

**â” FileUploadController**

```java
@Controller
@RequestMapping("/upload")
public class FileUploadController {

  @Value("${custom.genFileDirPath}")
  private String genFileDirPath;

  @RequestMapping("")
  @ResponseBody
  public String upload(@RequestParam("img1") MultipartFile img1, @RequestParam("img2") MultipartFile img2) {
    try {
      img1.transferTo(new File(genFileDirPath + "/1.png"));
      img2.transferTo(new File(genFileDirPath + "/2.png"));
    } catch (IOException e) {
      throw new RuntimeException(e);
    }
    return "ì—…ë¡œë“œ ì™„ë£Œ";
  }
}
```

**@RequestParamìœ¼ë¡œ MultipartFile íƒ€ì…ì„ í†µí•´ íŒŒì¼ ë°ì´í„°ë¥¼ ë‹¤ë£¨ì–´ ì§€ì •ëœ ê²½ë¡œì— ì €ì¥í•´ì¤€ë‹¤.**

<br>

**â” ì™¸ë¶€ ê²½ë¡œ Mapping**

```java
@Configuration
public class WebMvcConfig implements WebMvcConfigurer {
    @Value("${custom.genFileDirPath}")
    private String genFileDirPath;

    @Override
    public void addResourceHandlers(ResourceHandlerRegistry registry) {
        registry.addResourceHandler("/gen/**")
                .addResourceLocations("file:///" + genFileDirPath + "/");
    }
}
```

**ì—…ë¡œë“œ ëœ ì´ë¯¸ì§€ì— URLì´ ë¶€ì—¬ë˜ë©°, í•´ë‹¹ URLì„ í†µí•´ ì ‘ê·¼ì´ ê°€ëŠ¥í•´ì§„ë‹¤.**

<br>

**â” í…ŒìŠ¤íŠ¸ í™˜ê²½**

1. **ìš”ì²­ ë©”ì†Œë“œ**
  - **param / params : ì¿¼ë¦¬ ìŠ¤íŠ¸ë§ ì„¤ì •**
  - **cookie : ì¿ í‚¤ ì„¤ì •**
  - **requestAttr : ìš”ì²­ ìŠ¤ì½”í”„ ê°ì²´ ì„¤ì •**
  - **sessionAttr : ì„¸ì…˜ ìŠ¤ì½”í”„ ê°ì²´ ì„¤ì •**
  - **content : ìš”ì²­ ë³¸ë¬¸ ì„¤ì •**
  - **header / headers : ìš”ì²­ í—¤ë” ì„¤ì •**
  - **contentType : ë³¸ë¬¸ íƒ€ì… ì„¤ì •**

<br> 

2. **ê²€ì¦ ë©”ì†Œë“œ**
  - **status : ìƒíƒœ ì½”ë“œ ê²€ì¦**
  - **header : ì‘ë‹µ header ê²€ì¦**
  - **content : ì‘ë‹µ ë³¸ë¬¸ ê²€ì¦**
  - **cookie : ì¿ í‚¤ ìƒíƒœ ê²€ì¦**
  - **view : ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ë°˜í™˜í•œ ë·° ì´ë¦„ ê²€ì¦**
  - **redirectedUrl(Pattern) : ë¦¬ë‹¤ì´ë ‰íŠ¸ ëŒ€ìƒì˜ ê²½ë¡œ ê²€ì¦**
  - **model : ìŠ¤í”„ë§ MVC ëª¨ë¸ ìƒíƒœ ê²€ì¦**
  - **request : ì„¸ì…˜ ìŠ¤ì½”í”„, ë¹„ë™ê¸° ì²˜ë¦¬, ìš”ì²­ ìŠ¤ì½”í”„ ìƒíƒœ ê²€ì¦**
  - **forwardedUrl : ì´ë™ëŒ€ìƒì˜ ê²½ë¡œ ê²€ì¦**

<br>

3. **ì‘ë‹µ ìƒíƒœ ì½”ë“œ**
  - **isOk() : ìƒíƒœ ì½”ë“œê°€ 200ì¸ì§€ í™•ì¸**
  - **isNotFount() : 404ì¸ì§€ í™•ì¸**
  - **isMethodNotAllowed() : 405ì¸ì§€ í™•ì¸**
  - **isInternalServerError() : 500ì¸ì§€ í™•ì¸**
  - **is(int status) : ì„ì˜ë¡œ ì§€ì •í•œ ìƒíƒœ ì½”ë“œì¸ì§€ í™•ì¸**

<br>

## ğŸ“Œ íšŒê³  ê³¼ì •ì—ì„œ ë‚˜ì™”ë˜ ì§ˆë¬¸

**MockMVCë€?**

**ì›¹ ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„ì— ë°°í¬í•˜ì§€ ì•Šì•„ë„ ìš”ì²­ ë° ì „ì†¡, ì‘ë‹µê¸°ëŠ¥ì„ ì œê³µí•´ì£¼ê¸° ìœ„í•´ í…ŒìŠ¤íŠ¸ìš© MVCí™˜ê²½ì„ ë§Œë“¤ì–´ ì£¼ëŠ” ìœ í‹¸ë¦¬í‹° í´ë˜ìŠ¤ë‹¤.**

**`@AutoConfigureMockMvc` ì–´ë…¸í…Œì´ì…˜ì„ í´ë˜ìŠ¤ ìœ„ì— ë¶™ì—¬ì„œ ì‚¬ìš©í•´ì¤„ ìˆ˜ ìˆë‹¤.**

```java
@Autowired
private MockMvc mockMvc; // mockMvc ìƒì„±
```

<br>

## ğŸ“Œ íšŒê³  ì¸ì¦ìƒ· & íŒ€ ìë‘

<img src="https://user-images.githubusercontent.com/73464584/188900545-779a853f-6da2-4404-ade6-2a777602b6e1.png">

- **ì¤‘ìš”í•˜ë‹¤ê³  ìƒê°í•˜ëŠ” ë¶€ë¶„, ê¶ê¸ˆí–ˆë˜ ë¶€ë¶„, ì–´ë ¤ì› ë˜ ë¶€ë¶„ë“¤ì„ ì •ë¦¬í•˜ì—¬ ê³µìœ í•˜ê³  ìˆìŠµë‹ˆë‹¤.**
- **ì„œë¡œ ì–´ë–»ê²Œ ì´í•´ë¥¼ í•˜ê³  ìˆëŠ”ì§€ ë‚˜ëˆ„ë©°, ìˆ˜ì—…ì„ ê°€ë³ê²Œ ë³µìŠµí•˜ë©° íšŒê³ ë¥¼ ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤.** ğŸ‘